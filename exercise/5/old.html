
<!DOCTYPE html>

<html>
  <head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/rxjs/6.6.3/rxjs.umd.min.js" integrity="sha512-JnZPWAckMDks0CCIeGznqEo7ifmYK7VowHq/NVFlSXGkwxv4OBCJFy7nouOtJZmVldHo7FQLIdeWTI55yyZc4Q==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.1/socket.io.min.js" integrity="sha512-/WwtKR6NnHomLo0O4w9QKc1INTPEJs7ko6u2aBTA1paPldhPl8LtXsi7a35iEZ69+9P5dcgVNESG8hrP4Y2t3w==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/highlight.min.js" integrity="sha512-Ypjm0o7jOxAd4hpdoppSEN0TQOC19UtPAqD+4s5AlXmUvbmmS/YMxYqAqarQYyxTnB6/rqip9qcxlNB/3U9Wdg==" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.1/styles/github.min.css" integrity="sha512-7QTQ5Qsc/IL1k8UU2bkNFjpKTfwnvGuPYE6fzm6yeneWTEGiA3zspgjcTsSgln9m0cn3MgyE7EnDNkF1bB/uCw==" crossorigin="anonymous" />

    <script>
      const { fromEvent, operators } = rxjs;
      const { map, scan } = operators;
      var _socket = null;
      var _sub = null;

      function loaded() {
        const main = document.getElementById("main");

        _socket = io("http://edcsystem.hopto.org/");
        _sub = fromEvent(_socket, "data")
            .pipe(
                scan((acc, value) => Object.assign(acc, value), {}),
                map(object => Object.entries(object).reduce((acc, [k, v]) => `${acc}<h1>${k}</h1><pre><code class="hljs json">${hljs.highlight("json", JSON.stringify(v, null, 2)).value}</code></pre>`, ""))
            ).subscribe(code => main.innerHTML = code);
      }

      function unloaded() {
        _sub.unsubscribe();
        _socket.close();
      }
    </script>
  </head>
  <body onload="loaded()" onunload="unloaded()">
    <div id="main" />
  </body>
</html>
